# 백업 데이터 가져오기 가이드

백업 파일에서 scores 테이블의 데이터만 추출하여 새 Supabase 프로젝트에 삽입하는 방법입니다.

## 사전 준비

1. ✅ 새 Supabase 프로젝트 생성 완료
2. ✅ 환경 변수 설정 완료 (`.env` 파일 또는 환경 변수)
3. ✅ `scores` 테이블 생성 완료 (`supabase_schema.sql` 실행)

## 실행 방법

### 방법 1: .env 파일 사용 (권장)

`.env` 파일이 프로젝트 루트에 있는 경우:

```bash
node import-scores.js
```

스크립트가 자동으로 `.env` 파일을 읽어 환경 변수를 로드합니다.

### 방법 2: 환경 변수 직접 설정

`.env` 파일이 없는 경우:

```bash
export REACT_APP_SUPABASE_URL=https://your-project-id.supabase.co
export REACT_APP_SUPABASE_ANON_KEY=your-anon-key
node import-scores.js
```

## 스크립트 동작

1. **백업 파일 읽기**: `backups/db_cluster-11-09-2025@15-17-06.backup` 파일에서 scores 데이터 추출
2. **데이터 파싱**: 탭으로 구분된 데이터를 파싱하여 객체 배열로 변환
3. **배치 삽입**: 100개씩 배치로 나누어 Supabase에 삽입 (성능 최적화)
4. **진행 상황 표시**: 각 배치의 진행 상황과 성공/실패 여부 표시
5. **결과 요약**: 전체 삽입 결과 요약 표시

## 출력 예시

```
🎨 Color Quiz - Scores 데이터 가져오기
=====================================

📖 백업 파일 읽는 중...
✅ 백업 파일 읽기 완료

🔍 scores 데이터 추출 중...
✅ 220개의 레코드를 추출했습니다.

🔍 기존 데이터 확인 중...
✅ 기존 데이터 없음

📊 총 220개의 레코드를 삽입합니다...
📦 배치 크기: 100

✅ 배치 1/3 완료 (100/220, 45.5%)
✅ 배치 2/3 완료 (200/220, 90.9%)
✅ 배치 3/3 완료 (220/220, 100.0%)

=====================================
📊 삽입 결과:
   성공: 220개
   실패: 0개
   전체: 220개
=====================================

✅ 모든 데이터가 성공적으로 삽입되었습니다!
```

## 문제 해결

### 환경 변수 오류

```
❌ 환경 변수가 설정되지 않았습니다.
```

**해결 방법:**
- `.env` 파일이 프로젝트 루트에 있는지 확인
- 환경 변수가 올바르게 설정되었는지 확인
- `echo $REACT_APP_SUPABASE_URL`로 확인

### 백업 파일을 찾을 수 없음

```
❌ 백업 파일을 찾을 수 없습니다: backups/db_cluster-11-09-2025@15-17-06.backup
```

**해결 방법:**
- 백업 파일이 `backups/` 디렉토리에 있는지 확인
- 파일 이름이 정확한지 확인

### 삽입 실패

```
❌ 배치 X/Y 삽입 실패: ...
```

**가능한 원인:**
- Supabase 프로젝트 URL이나 Key가 잘못됨
- `scores` 테이블이 생성되지 않음
- RLS 정책이 올바르게 설정되지 않음
- 네트워크 연결 문제

**해결 방법:**
1. Supabase Dashboard에서 테이블이 올바르게 생성되었는지 확인
2. RLS 정책이 올바르게 설정되었는지 확인
3. 네트워크 연결 확인
4. Supabase 프로젝트가 활성화되어 있는지 확인

### 기존 데이터와 충돌

스크립트는 기존 데이터를 삭제하지 않고 추가만 합니다. 기존 데이터를 삭제하고 새로 시작하려면:

1. Supabase Dashboard > Table Editor > scores 테이블
2. 모든 행 선택 후 삭제
3. 스크립트 다시 실행

또는 SQL Editor에서:

```sql
TRUNCATE TABLE scores;
```

## 주의사항

- ⚠️ 스크립트는 기존 데이터를 삭제하지 않습니다. 중복 삽입을 방지하려면 먼저 테이블을 비우세요.
- ⚠️ 대량의 데이터를 삽입할 때는 시간이 걸릴 수 있습니다.
- ⚠️ 네트워크 연결이 불안정하면 일부 배치가 실패할 수 있습니다. 실패한 경우 스크립트를 다시 실행하세요.

